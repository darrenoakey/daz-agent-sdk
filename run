#!/usr/bin/env python3
# run â€” pure bootstrap facade. No logic here. Everything delegates to src/main.py.
import os
import subprocess
import sys
from pathlib import Path

SCRIPT_DIR = Path(__file__).parent.resolve()
VENV = SCRIPT_DIR / ".venv"
REQS = SCRIPT_DIR / "requirements.txt"
PYTHON = VENV / "bin" / "python"

if Path(sys.executable).resolve() != PYTHON.resolve():
    if not VENV.exists():
        subprocess.run([sys.executable, "-m", "venv", str(VENV)], check=True)
    if REQS.exists():
        subprocess.run([str(PYTHON), "-m", "pip", "install", "-q", "-r", str(REQS)], check=True)
    os.execv(str(PYTHON), [str(PYTHON), str(Path(__file__).resolve())] + sys.argv[1:])
else:
    # handle install command before importing main (no deps needed)
    if len(sys.argv) > 1 and sys.argv[1] == "install":
        print("Installing daz-agent-sdk as editable package (system-wide)...")
        rc = subprocess.run(
            [sys.executable, "-m", "pip", "install", "-e", str(SCRIPT_DIR)],
        ).returncode
        sys.exit(rc)

    sys.path.insert(0, str(SCRIPT_DIR / "src"))
    from daz_agent_sdk.main import main
    sys.exit(main())
